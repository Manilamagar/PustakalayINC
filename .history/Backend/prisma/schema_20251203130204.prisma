// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
}

datasource db {
  provider = "mysql"
   url      = env("DATABASE_URL")
}

enum Role {
  Student
  Teacher
  Librarian
}

enum LoanStatus {
  Borrowed
  Returned
  Overdue
}

enum ReservationStatus {
  Active
  Fulfilled
  Cancelled
}

model User {
  id            Int               @id @default(autoincrement())
  name          String?
  email         String            @unique
  password      String
  role          Role
  phone         Int
  address       String
  loans         Loan[]
  reservations  Reservation[]
}

model Author {
  id     Int     @id @default(autoincrement())
  name   String
  bio    String?
  books  Book[]
}

model Publisher {
  id      Int     @id @default(autoincrement())
  name    String
  address String?
  books   Book[]
}

model Category {
  id     Int     @id @default(autoincrement())
  name   String
  books  Book[]
}

model Book {
  id                  Int         @id @default(autoincrement())
  title               String
  isbn                String      @unique
  author_id           Int
  publisher_id        Int
  category_id         Int
  quantity            Int
  available_quantity  Int
  description         String?
  publication_year    Int?
  author              Author      @relation(fields: [author_id], references: [id])
  publisher           Publisher   @relation(fields: [publisher_id], references: [id])
  category            Category    @relation(fields: [category_id], references: [id])
  loans               Loan[]
  reservations        Reservation[]
}

model Loan {
  id          Int         @id @default(autoincrement())
  user_id     Int
  book_id     Int
  borrow_date DateTime    @default(now())
  due_date    DateTime
  return_date DateTime?
  status      LoanStatus  @default(Borrowed)
  user        User        @relation(fields: [user_id], references: [id])
  book        Book        @relation(fields: [book_id], references: [id])
  fines       Fine[]
}

model Reservation {
  id                Int               @id @default(autoincrement())
  user_id           Int
  book_id           Int
  reservation_date  DateTime          @default(now())
  status            ReservationStatus @default(Active)
  user              User              @relation(fields: [user_id], references: [id])
  book              Book              @relation(fields: [book_id], references: [id])
}

model Fine {
  id         Int      @id @default(autoincrement())
  loan_id    Int
  amount     Float
  paid       Boolean  @default(false)
  paid_date  DateTime?
  loan       Loan     @relation(fields: [loan_id], references: [id])
}
